---
title: 浅拷贝与深拷贝
date: 2018-05-30 15:47:12
tags: "JavaScript"
categories: JavaScript
---

![](https://i.imgur.com/1LiUH1R.jpg)

<!--more-->

#### 什么是浅拷贝 / 深拷贝 ?

##### 浅拷贝

对于字符串类型 , 浅拷贝就是对值的复制 , 对于对象来说 , 浅拷贝是对对象地址的拷贝 , 并没有开辟的新的栈 , 也就是复制的结果是两个对象指向同一个地址 , 修改其中一个对象的属性 , 则另一个对象的属性也会改变.

	/* 浅拷贝 */
	var obj1 = {
        name: 'tom',
        receiveInfo: { // 父对象中 receiveInfo 属性是另外两个对象 , 而不是简单数据类型  
            home: 'home1',
            school: 'school1'
        }
    };
    var obj2 = {};

    function shallowCopy(obj1, obj2) {
        for (var key in obj1) {
            if (obj1.hasOwnProperty(key)) {
                obj2[key] = obj1[key];
            }
        }
    };

    shallowCopy(obj1, obj2);
    obj2.receiveInfo.home = 'home2';
    console.log(obj2.receiveInfo.home); // home2
    console.log(obj1.receiveInfo.home); // home2

父对象 obj 的属性没有定义为基本数据类型(基本数据类型的定义都会开辟新的内存) , 而是指向了另外两个对象属性 , 这时子类从父类里拷贝的 receiveInfo 属性是 receiveInfo 的内存地址 , 也就是说子类和父类指向同一内存地址 , 改变了子类父类也就跟着改变.

#### 深拷贝

所谓深拷贝 , 就是能实现真正意义上数组和对象的拷贝 , 可以通过递归的方式实现 , 从而解决上述栗子中的问题.
	
	/* 深拷贝 */
	var obj1 = {
        name: 'tom',
        receiveInfo: {
            home: 'home1',
            school: 'school1'
        }
    };

    function deepCopy(obj) {
        var objArray = Array.isArray(obj) ? [] : {}; // 对象数组区别处理
        if (obj && typeof obj === "object") { // 判断是否为基本数据类型
            for (var key in obj) {
                if (obj.hasOwnProperty(key)) {
                    if (obj[key] && typeof obj[key] === "object") {
                        objArray[key] = deepCopy(obj[key]); // 如果是对象 , 则拷贝
                    } else {
                        objArray[key] = obj[key]; // 否则直接赋值
                    }
                }
            }
        }
        return objArray;
    }

    var obj2 = deepCopy(obj1);
    obj2.receiveInfo.home = 'home2';
    console.log(obj1.receiveInfo.home); // home1
    console.log(obj2.receiveInfo.home); // home2

现在可以看到 , 子类拷贝父类而不改变父类 , 实现了所谓继承.

#### 其它方法

jQuery 提供了 extend 方法

jQuery.extend([deep], target, object1, [objectN])

	var obj = {
        _name: 'Tom',
        _receiveInfo: {
            home: 'home1',
            school: 'school'
        }
    }
    var obj2 = $.extend(true, {}, obj); 
	// 第一个参数设置为true , 则jQuery返回一个深层次的副本 , 递归地复制找到的任何对象
    obj2._receiveInfo.home = 'home2';
    console.log(obj._receiveInfo.home); // home1
    console.log(obj2._receiveInfo.home); // home2

--------------------------------------------------------------------------------------------- EOF ----------------------------------------------------------------------------------------------------